<div class="container mat-elevation-z8">
    <app-spinner></app-spinner>
    <router-outlet></router-outlet>
    <h1 class="full-width">Configurações do Usuário</h1>
    <img class="full-width" src="assets/img/chamado-create.svg" alt="Imagem de Configurações">

    <form [formGroup]="settingsForm" class="form" (ngSubmit)="updateSettings()">
        <mat-form-field class="full-width" appearance="outline">
            <mat-label>ID</mat-label>
            <input
                    matInput
                    id="id"
                    formControlName="id"
                    required
                    readonly
            />
            <mat-error *ngIf="settingsForm.get('id')?.hasError('required')">
                ID é obrigatório
            </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width" appearance="outline">
            <mat-label>Nome</mat-label>
            <input
                    matInput
                    id="name"
                    formControlName="nome"
                    required
                    readonly
            />
            <mat-error *ngIf="settingsForm.get('nome')?.hasError('required')">
                Nome é obrigatório
            </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width" appearance="outline">
            <mat-label>Email</mat-label>
            <input
                    matInput
                    id="email"
                    formControlName="email"
                    required
                    readonly
                    type="email"
            />
            <mat-error *ngIf="settingsForm.get('email')?.hasError('required')">
                Email é obrigatório
            </mat-error>
            <mat-error *ngIf="settingsForm.get('email')?.hasError('email')">
                Email inválido
            </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width" appearance="outline">
            <mat-label>Senha Atual</mat-label>
            <div class="password-container">
                <input
                        matInput
                        id="currentPassword"
                        formControlName="senhaAtual"
                        type="password"
                        [type]="showPassword.senhaAtual ? 'text' : 'password'"
                        (focus)="revealPasswordFields()"
                />
                <div class="button-group">
                    <button
                            type="button"
                            mat-icon-button
                            (click)="togglePasswordVisibility('senhaAtual')"
                            class="password-visibility-button"
                    >
                        <mat-icon>{{ showPassword.senhaAtual ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <button
                            type="button"
                            mat-icon-button
                            class="info-button"
                            matTooltip="Digite a sua senha atual, antes de escolher uma nova senha."
                            aria-label="Informação sobre a senha atual"
                    >
                        <mat-icon>info_outline</mat-icon>
                    </button>
                </div>
            </div>
            <mat-error *ngIf="settingsForm.get('senhaAtual')?.hasError('required')">
                Senha atual é obrigatória
            </mat-error>
        </mat-form-field>

        <div *ngIf="showPasswordFields" class="password-fields">
            <mat-form-field class="full-width" appearance="outline">
                <mat-label>Nova Senha</mat-label>
                <div class="password-container">
                    <input
                            matInput
                            id="newPassword"
                            formControlName="senhaNova"
                            type="password"
                            [type]="showPassword.senhaNova ? 'text' : 'password'"
                            (input)="validatePassword('senhaNova')"
                    />
                    <div class="button-group">
                        <button
                                type="button"
                                mat-icon-button
                                (click)="togglePasswordVisibility('senhaNova')"
                                class="password-visibility-button"
                        >
                            <mat-icon>{{ showPassword.senhaNova ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>
                        <button
                                type="button"
                                mat-icon-button
                                class="info-button"
                                matTooltip="A nova senha deve ter pelo menos 10 caracteres e incluir pelo menos uma letra maíscula, uma minúscula, um número e um caractere especial."
                                aria-label="Informação sobre a nova senha"
                        >
                            <mat-icon>info_outline</mat-icon>
                        </button>
                    </div>
                </div>
                <mat-error *ngIf="settingsForm.get('senhaNova')?.hasError('required')">
                    Nova senha é obrigatória
                </mat-error>
                <mat-error *ngIf="settingsForm.get('senhaNova')?.hasError('minlength')">
                    A nova senha deve ter pelo menos 6 caracteres
                </mat-error>
                <mat-error *ngIf="passwordErrors.senhaNova?.invalidPassword">
                    {{ passwordErrors.senhaNova.invalidPassword }}
                </mat-error>
            </mat-form-field>

            <mat-form-field class="full-width" appearance="outline">
                <mat-label>Confirmar Nova Senha</mat-label>
                <div class="password-container">
                    <input
                            matInput
                            id="confirmNewPassword"
                            formControlName="confirmaSenhaNova"
                            type="password"
                            [type]="showPassword.confirmaSenhaNova ? 'text' : 'password'"
                            (input)="validatePassword('confirmaSenhaNova')"
                    />
                    <div class="button-group">
                        <button
                                type="button"
                                mat-icon-button
                                (click)="togglePasswordVisibility('confirmaSenhaNova')"
                                class="password-visibility-button"
                        >
                            <mat-icon>{{ showPassword.confirmaSenhaNova ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>
                        <button
                                type="button"
                                mat-icon-button
                                class="info-button"
                                matTooltip="Confirme a nova senha para garantir que corresponde à senha digitada."
                                aria-label="Informação sobre a confirmação da nova senha"
                        >
                            <mat-icon>info_outline</mat-icon>
                        </button>
                    </div>
                </div>
                <mat-error *ngIf="settingsForm.get('confirmaSenhaNova')?.hasError('required')">
                    Confirmação de senha é obrigatória
                </mat-error>
                <mat-error *ngIf="settingsForm.hasError('passwordsMismatch')">
                    As senhas não coincidem
                </mat-error>
            </mat-form-field>

            <button
                    type="button"
                    (click)="cancelPasswordEdit()"
                    class="full-width mat-elevation-z4"
                    mat-raised-button
                    color="warn"
            >
                Cancelar
            </button>
        </div>

        <mat-form-field class="full-width" appearance="outline">
            <mat-label>Tema</mat-label>
            <mat-select
                    id="theme"
                    formControlName="tema"
                    required
                    (selectionChange)="onThemeChange($event)"
            >
                <mat-option *ngFor="let theme of availableThemes" [value]="theme">
                    {{ theme | titlecase }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <ng-container formArrayName="roles">
            <div *ngFor="let roleControl of rolesControls; let i = index">
                <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Permissão {{ i + 1 }}</mat-label>
                    <input matInput [value]="translateRole(roleControl.value)" readonly>
                </mat-form-field>
            </div>
        </ng-container>

        <button
                type="submit"
                [disabled]="!isSaveEnabled"
                class="full-width mat-elevation-z4"
                mat-raised-button
                color="primary"
        >
            Salvar
        </button>
    </form>

    <p class="full-width">Desenvolvido por Luiz Generoso</p>
</div>
